From 34a42ce72fc9a640a59c26dd3ec6eed4b7115e59 Mon Sep 17 00:00:00 2001
From: Mikolaj Izdebski <mizdebsk@redhat.com>
Date: Fri, 21 Nov 2014 14:51:51 +0100
Subject: [PATCH] Port to Java 8

---
 src/main/java/aQute/bnd/signing/Signer.java       | 4 ++--
 src/main/java/aQute/lib/collections/MultiMap.java | 2 +-
 src/main/java/aQute/lib/osgi/Analyzer.java        | 4 ++--
 src/main/java/aQute/lib/osgi/Clazz.java           | 6 ++++++
 src/main/java/aQute/lib/osgi/Jar.java             | 2 +-
 5 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/src/main/java/aQute/bnd/signing/Signer.java b/src/main/java/aQute/bnd/signing/Signer.java
index bed91be..d3af5ef 100644
--- a/src/main/java/aQute/bnd/signing/Signer.java
+++ b/src/main/java/aQute/bnd/signing/Signer.java
@@ -119,7 +119,7 @@ public class Signer extends Processor {
             if (algorithms[a] != null) {
                 byte[] digest = algorithms[a].digest(manbytes);
                 ps.print(digestNames[a] + "-Digest-Manifest: ");
-                ps.print(new Base64(digest));
+                ps.print(new aQute.lib.base64.Base64(digest));
                 ps.print("\r\n");
             }
         }
@@ -142,7 +142,7 @@ public class Signer extends Processor {
                     if (algorithms[a] != null) {
                         byte[] digest = algorithms[a].digest();
                         String header = digestNames[a] + "-Digest: "
-                                + new Base64(digest) + "\r\n";
+                                + new aQute.lib.base64.Base64(digest) + "\r\n";
                         out.write(header.getBytes());
                     }
                 }
diff --git a/src/main/java/aQute/lib/collections/MultiMap.java b/src/main/java/aQute/lib/collections/MultiMap.java
index 7672638..e5ccb7c 100644
--- a/src/main/java/aQute/lib/collections/MultiMap.java
+++ b/src/main/java/aQute/lib/collections/MultiMap.java
@@ -24,7 +24,7 @@ public class MultiMap<K,V> extends HashMap<K,Set<V>> {
 		return set.addAll(value);
 	}
 	
-	public boolean remove( K key, V value ) {
+	public boolean remove( Object key, Object value ) {
 		Set<V> set = get(key);
 		if ( set == null) {
 			return false;
diff --git a/src/main/java/aQute/lib/osgi/Analyzer.java b/src/main/java/aQute/lib/osgi/Analyzer.java
index 957269a..ee7291f 100644
--- a/src/main/java/aQute/lib/osgi/Analyzer.java
+++ b/src/main/java/aQute/lib/osgi/Analyzer.java
@@ -2278,7 +2278,7 @@ public class Analyzer extends Processor {
 		if (hex)
 			return Hex.toHexString(digester.digest().digest());
 		else
-			return Base64.encodeBase64(digester.digest().digest());
+			return aQute.lib.base64.Base64.encodeBase64(digester.digest().digest());
 	}
 
 	/**
@@ -2296,6 +2296,6 @@ public class Analyzer extends Processor {
 			throw new FileNotFoundException("From sha1, not found " + args[1]);
 
 		IO.copy(r.openInputStream(), digester);
-		return Base64.encodeBase64(digester.digest().digest());
+		return aQute.lib.base64.Base64.encodeBase64(digester.digest().digest());
 	}
 }
diff --git a/src/main/java/aQute/lib/osgi/Clazz.java b/src/main/java/aQute/lib/osgi/Clazz.java
index cb5e1f0..e70b079 100644
--- a/src/main/java/aQute/lib/osgi/Clazz.java
+++ b/src/main/java/aQute/lib/osgi/Clazz.java
@@ -311,6 +311,12 @@ public class Clazz {
 			4, // 10 CONSTANT_MethodRef
 			4, // 11 CONSTANT_InterfaceMethodRef
 			4, // 12 CONSTANT_NameAndType
+			-1, // 13 Not defined
+			-1, // 14 Not defined
+			3, // 15 CONSTANT_MethodHandle
+			2, // 16 CONSTANT_MethodType
+			-1, // 17 Not defined
+			4, // 18 CONSTANT_InvokeDynamic
 									};
 
 	boolean				isAbstract;
diff --git a/src/main/java/aQute/lib/osgi/Jar.java b/src/main/java/aQute/lib/osgi/Jar.java
index c8b2359..8f1f98c 100644
--- a/src/main/java/aQute/lib/osgi/Jar.java
+++ b/src/main/java/aQute/lib/osgi/Jar.java
@@ -624,7 +624,7 @@ public class Jar implements Closeable {
 				in.close();
 			}
 			for (MessageDigest d : digests)
-				attributes.putValue(d.getAlgorithm() + "-Digest", Base64.encodeBase64(d.digest()));
+				attributes.putValue(d.getAlgorithm() + "-Digest", aQute.lib.base64.Base64.encodeBase64(d.digest()));
 		}
 	}
 
-- 
2.1.0

